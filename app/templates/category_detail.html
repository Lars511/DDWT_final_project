{% extends "base.html" %}
{% block content %}

<div class="activities-page">

    <div class="activities-header">
        <h1>{{ category.name }}</h1>
    </div>


    <h2>Activities in this category</h2>

    {% if activities %}
    <table class="activities-table">
        <thead>
            <tr>
                <th>Title</th>
                <th>Activity Type</th>
                <th>Description</th>
                <th>Location</th>
                <th>Date</th>
                <th>Time</th>
                <th>Participants</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for activity in activities %}
            <tr>
                <td>{{ activity.title }}</td>
                <td>{{ activity.get_activity_type().name if activity.get_activity_type() else "-" }}</td>
                <td>{{ activity.description }}</td>
                <td>{{ activity.location }}</td>
                <td>{{ activity.activity_date }}</td>
                <td>{{ activity.activity_time }}</td>
                <td>
                    {{ activity.get_participant_count() }} / {{ activity.max_participants }}

                    {% if activity.has_user_joined(current_user.id) and activity.get_participant_count() > 0 %}
                        <details>
                            <summary>View participants</summary>
                            <ul>
                                <li>
                                    <a href="{{ url_for('profile', username=activity.creator.username) }}">
                                        <strong>{{ activity.creator.username }} (Host)</strong>
                                    </a>
                                </li>
                                {% for participant in activity.get_participants() %}
                                    {% if participant.id != activity.creator_id %}
                                        <li>
                                            <a href="{{ url_for('profile', username=participant.username) }}">
                                                {{ participant.username }}
                                            </a>
                                        </li>
                                    {% endif %}
                                {% endfor %}
                            </ul>
                        </details>
                    {% endif %}
                </td>
                <td class="actions">
                    {% if activity.creator_id == current_user.id %}
                        <a href="{{ url_for('edit_activity', id=activity.id) }}" class="btn-edit">Edit</a>
                        <form method="POST" action="{{ url_for('delete_activity', id=activity.id) }}">
                            <button class="btn-delete">Delete</button>
                        </form>
                    {% endif %}

                    {% if activity.has_user_joined(current_user.id) %}
                        <form method="POST" action="{{ url_for('leave_activity', id=activity.id) }}">
                            <button class="btn-leave">Leave</button>
                        </form>
                    {% elif not activity.is_full() %}
                        <form method="POST" action="{{ url_for('join_activity', id=activity.id) }}">
                            <button class="btn-join">Join</button>
                        </form>
                    {% else %}
                        <span class="full-label">Full</span>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
        <p>No upcoming activities for this category yet.</p>
    {% endif %}

    <hr>

    <h2>Associated activity types</h2>

    {% if activity_types %}
        <div class="activity-type-tags">
            {% for activity_type in activity_types %}
                <span class="activity-type-tag">
                    {{ activity_type.name }}
                </span>
            {% endfor %}
        </div>

    {% else %}
        <p>No activity types available for this category.</p>
    {% endif %}

    <p>
        <a href="{{ url_for('categories') }}">‚Üê Back to categories</a>
    </p>

</div>

{% endblock %}
